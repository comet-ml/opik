import { z } from "zod";
import { Trace, Thread } from "./traces";

/**
 * Context type for custom view - determines what data is being visualized
 */
export type ContextType = "trace" | "thread";

/**
 * Union type for context data - can be either Trace or Thread
 */
export type ContextData = Trace | Thread;

/**
 * Supported widget types for custom trace visualization
 */
export enum WidgetType {
  TEXT = "text",
  NUMBER = "number",
  BOOLEAN = "boolean",
  CODE = "code",
  LINK = "link",
  IMAGE = "image",
  VIDEO = "video",
  AUDIO = "audio",
  PDF = "pdf",
  FILE = "file",
}

/**
 * Widget size for layout control
 * - small: 1/3 width on desktop (numbers, booleans, short text, links)
 * - medium: 1/2 width on desktop (text, images, audio)
 * - large: 2/3 width on desktop (code blocks, JSON, video, PDFs)
 * - full: full width (special cases)
 */
export enum WidgetSize {
  SMALL = "small",
  MEDIUM = "medium",
  LARGE = "large",
  FULL = "full",
}

/**
 * Individual widget configuration in the custom view
 */
export interface ViewWidget {
  /** Display label for the widget */
  label: string;
  /** Dot notation path to data in trace object (e.g., 'input.messages[0].content') */
  path: string;
  /** Type of UI widget to render */
  uiWidget: WidgetType;
  /** Size of the widget for layout control */
  size: WidgetSize;
}

/**
 * Complete custom view schema returned by AI
 */
export interface CustomViewSchema {
  /** Human-readable explanation of the view */
  responseSummary: string;
  /** Array of widgets to render */
  widgets: ViewWidget[];
}

/**
 * Zod schema for validating AI responses
 */
export const customViewZodSchema = z.object({
  responseSummary: z
    .string()
    .describe("Human-readable explanation of the view"),
  widgets: z
    .array(
      z.object({
        label: z.string().describe("Display label for the widget"),
        path: z
          .string()
          .describe(
            "Dot notation path to data (e.g., 'input.messages[0].content')",
          ),
        uiWidget: z
          .enum([
            "text",
            "number",
            "boolean",
            "code",
            "link",
            "image",
            "video",
            "audio",
            "pdf",
            "file",
          ])
          .describe("Type of UI widget to render"),
        size: z
          .enum(["small", "medium", "large", "full"])
          .describe(
            "Widget size: small (numbers, booleans, short text), medium (text, images), large (code, video, PDFs), full (special cases).",
          ),
      }),
    )
    .describe("Array of widgets to display in the custom view"),
});

/**
 * Props for individual widget components
 */
export interface WidgetProps {
  /** Resolved value from trace object */
  value: unknown;
  /** Display label */
  label: string;
  /** Original path (for debugging/tooltips) */
  path: string;
}

/**
 * View source type to track where the current schema came from
 * - 'ai': Freshly generated by AI
 * - 'saved': Loaded from localStorage
 * - 'empty': No schema available yet
 */
export type ViewSource = "ai" | "saved" | "empty";
