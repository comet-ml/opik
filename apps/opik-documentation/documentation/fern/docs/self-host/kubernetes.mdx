---
subtitle: Describes how to run Opik on a Kubernetes cluster
---

> **Important:** If you're using or looking to use Opik or Comet enterprise version please reach out to Sales@comet.com to gain access to the correct deployment documentation.


For production deployments, we recommend using our Kubernetes Helm chart. This chart is designed to be highly configurable and has been battle-tested in Comet's managed cloud offering.

## Prerequisites

In order to install Opik on a Kubernetes cluster, you will need to have the following tools installed:

- [Helm](https://helm.sh/)
- [kubectl](https://kubernetes.io/docs/tasks/tools/)
- Optional: [kubectx](https://github.com/ahmetb/kubectx) and [kubens](https://github.com/ahmetb/kubectx) to switch between Kubernetes clusters and namespaces.

## Installation

You can install Opik using the helm chart maintained by the Opik team by running the following commands:

```bash
# Add Opik Helm repo
helm repo add opik https://comet-ml.github.io/opik/
helm repo update

# You can set VERSION to the specific Opik version or leave it as 'latest'
VERSION=latest
# Install Opik
helm upgrade --install opik -n opik --create-namespace opik/opik \
    --set component.backend.image.tag=$VERSION \
    --set component.python-backend.image.tag=$VERSION \
    --set component.python-backend.env.PYTHON_CODE_EXECUTOR_IMAGE_TAG="$VERSION" \
    --set component.frontend.image.tag=$VERSION
```

You can port-forward any service you need to your local machine:

```bash
kubectl port-forward -n opik svc/opik-frontend 5173
```


Opik will be available at `http://localhost:5173`.

## Configuration

You can find a full list the configuration options in the [helm chart documentation](https://github.com/comet-ml/opik/tree/main/deployment/helm_chart/opik).

## Advanced deployment options

### Configure external access

#### Configure ingress for opik-frontend

```bash
component:
    frontend:
      ingress:
        enabled: true
        ingressClassName: <your ingress class>
        annotations:
            <your annotations>
        hosts:
            - host: opik.example.com
            paths:
                - path: /opik
                port: 5173
                pathType: Prefix
                - path: /opik/api
                port: 5173
                pathType: Prefix
```

#### Configure LoadBalancer service for clickhouse

```bash
clickhouse:
  service:
    serviceTemplate: clickhouse-cluster-svc-lb-template
    annotations:
      <your clickhouse LB service annotations>
```

### Configure Clickhouse backup on S3 (or minio)

#### With AWS Key and Secret key

You will need to create a secret with the credentials for the S3 bucket you want to use for backup with following values:
```bash
access_key_id: <your access key id>
access_key_secret: <your access key secret>
```
Add to your configuration
```bash
clickhouse:
  backup:
    enabled: true
    bucketURL: https://<your bucket.s3.<region>.amazonaws.com
    secretName: <your secret name with credential for clickhouse backup>
    schedule: <your cron schedule, like "00 03 * * *">
    baseBackup: ""
```

#### With IAM Role 

```bash
clickhouse:
    backup:
      serviceAccount:
        enabled: true
        annotations:
          eks.amazonaws.com/role-arn: <your IAM role arn>
      enabled: true
      bucketURL: https://<your bucket.s3.<region>.amazonaws.com
      schedule: <your cron schedule, like "00 03 * * *">
      baseBackup: ""
```

### Use S3 bucket for Opik

#### Using AWS key and secret keys

```bash
component:
  backend:
    env:
      IS_MINIO: "false"
      S3_BUCKET <your_bucket_name>
      S3_REGION <aws_region> 
      AWS_ACCESS_KEY_ID: <your AWS Key>
      AWS_SECRET_ACCESS_KEY: <your AWS Secret>
```

### Using IAM Role

If your IAM role is configured for the k8s nodes, the only things you will need is to set for opik-backend:

```bash
component:
  backend:
    env:
        IS_MINIO: "false"
        S3_BUCKET <your_bucket_name>
        S3_REGION <aws_region> 
        AWS_ACCESS_KEY_ID: ""
        AWS_SECRET_ACCESS_KEY: ""
```

If your role should be used by opik-backend serviceAccount, in addition you need to set:

```bash
component:
  backend:

    serviceAccount:
        enabled: true
        annotations:
            eks.amazonaws.com/role-arn: <your IAM Role arn>
```

### Using external Clickhouse installation
Supported from Opik chart version 1.4.2

Configuration snippet for using external Clickhouse:
```bash
component:
    backend:
      ...
      env:
        ANALYTICS_DB_MIGRATIONS_URL: "jdbc:clickhouse://<YOUR CLICKHOUSE HOST>:8123"
        ANALYTICS_DB_HOST: "<YOUR CLICKHOUSE HOST>"
        ANALYTICS_DB_DATABASE_NAME: "opik"
        ANALYTICS_DB_MIGRATIONS_USER: "opik"
        ANALYTICS_DB_USERNAME: "opik"
        ANALYTICS_DB_MIGRATIONS_PASS: "xxx"
        ANALYTICS_DB_PASS: "xxx"
    ...
clickhouse:
    enabled: false
```
The passwords can be handled in the secret, and then you should configure it as following
```bash
component:
    backend:
      ...
      envFrom:
        - configMapRef:
            name: opik-backend
        - secretRef:
            name: <your secret name>
      env:
        ANALYTICS_DB_MIGRATIONS_URL: "jdbc:clickhouse://<YOUR CLICKHOUSE HOST>:8123"
        ANALYTICS_DB_HOST: "<YOUR CLICKHOUSE HOST>"
        ANALYTICS_DB_DATABASE_NAME: "opik"
        ANALYTICS_DB_MIGRATIONS_USER: "opik"
        ANALYTICS_DB_USERNAME: "opik"
...
clickhouse:
    enabled: false
```

## Troubleshooting

If you get this error when running helm
```bash
ERROR: Exception Primary Reason:  Code: 225. DB::Exception: Can't create replicated table without ZooKeeper. (NO_ZOOKEEPER) (version 24.3.5.47.altinitystable (altinity build))
```
Please make sure you use the latest Opik helm chart version that runs zookeeper by default
