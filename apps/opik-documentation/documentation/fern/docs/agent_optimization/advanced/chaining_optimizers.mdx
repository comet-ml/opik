---
title: "Chaining optimizers"
description: "Run multiple optimizers in sequence to balance exploration and fine-tuning."
---

Some projects benefit from running two or more optimizers back-to-back. For example, use MetaPrompt to improve wording, then Parameter optimizer to fine-tune sampling settings. This guide explains how to orchestrate those workflows.

## Patterns

| Pattern | When to use |
| --- | --- |
| MetaPrompt → Parameter | Need better instructions plus temperature tuning. |
| Hierarchical Reflective → MetaPrompt | Use reflective analysis to identify fixes, then MetaPrompt to polish wording. |
| Evolutionary → Parameter | Explore broad prompt variants, then fine-tune the winning prompt’s sampling params. |

## Example pipeline

```python
from opik_optimizer import MetaPromptOptimizer, ParameterOptimizer, ChatPrompt
from opik_optimizer.parameter_optimizer import ParameterSearchSpace

meta = MetaPromptOptimizer(model="openai/gpt-4o")
parameter = ParameterOptimizer(model="openai/gpt-4o")

meta_result = meta.optimize_prompt(
    prompt=prompt,
    dataset=dataset,
    metric=metric,
    max_trials=4,
)

search_space = ParameterSearchSpace(parameters=[
    {"name": "temperature", "distribution": "float", "low": 0.1, "high": 0.9},
    {"name": "top_p", "distribution": "float", "low": 0.7, "high": 1.0},
])

final_result = parameter.optimize_parameter(
    prompt=ChatPrompt(messages=meta_result.prompt),
    dataset=dataset,
    metric=metric,
    parameter_space=search_space,
    max_trials=20,
)
```

## Checklist

- **Freeze datasets and metrics** between stages to keep comparisons fair.
- **Log pipeline metadata** (e.g., `experiment_config={"pipeline": "meta_then_param"}`) so dashboards show lineage.
- **Budget tokens** – chained runs multiply costs; start with smaller `n_samples` and increase once results look promising.

## Automation tips

- Use Makefiles or CI workflows to run stage 1 → stage 2 with clear checkpoints.
- Store intermediate prompts in version control alongside metadata (optimizer, score, dataset).
- Notify stakeholders with summary reports generated from `final_result.history`.

## Related docs

- [Optimize prompts](/agent_optimization/optimization/optimize_prompts)
- [Parameter optimizer](/agent_optimization/algorithms/parameter_optimizer)
