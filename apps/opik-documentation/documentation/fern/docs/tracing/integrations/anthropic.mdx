---
title: Observability for Anthropic with Opik
description: Start here to integrate Opik into your Anthropic-based genai application for end-to-end LLM observability, unit testing, and optimization.
---

[Anthropic](https://www.anthropic.com/) is an AI safety and research company that's working to build reliable, interpretable, and steerable AI systems.

This guide explains how to integrate Opik with the Anthropic Python SDK. By using the `track_anthropic` method provided by opik, you can easily track and evaluate your Anthropic API calls within your Opik projects as Opik will automatically log the input prompt, model used, token usage, and response generated.

## Account Setup

[Comet](https://www.comet.com/site?from=llm&utm_source=opik&utm_medium=colab&utm_content=anthropic&utm_campaign=opik) provides a hosted version of the Opik platform, [simply create an account](https://www.comet.com/signup?from=llm&utm_source=opik&utm_medium=colab&utm_content=anthropic&utm_campaign=opik) and grab your API Key.

> You can also run the Opik platform locally, see the [installation guide](https://www.comet.com/docs/opik/self-host/overview/?from=llm&utm_source=opik&utm_medium=colab&utm_content=anthropic&utm_campaign=opik) for more information.

## Getting Started

### Installation

To start tracking your Anthropic LLM calls, you'll need to have both the `opik` and `anthropic` packages. You can install them using pip:

```bash
pip install opik anthropic
```

### Configuring Opik

Configure the Opik Python SDK for your deployment type. See the [Python SDK Configuration guide](/tracing/sdk_configuration) for detailed instructions on:

- **CLI configuration**: `opik configure`
- **Code configuration**: `opik.configure()`
- **Self-hosted vs Cloud vs Enterprise** setup
- **Configuration files** and environment variables

### Configuring Anthropic

In order to configure Anthropic, you will need to have your Anthropic API Key set. You can [find or create your Anthropic API Key in this page](https://console.anthropic.com/settings/keys).

You can set it as an environment variable:

```bash {pytest_codeblocks_skip=true}
export ANTHROPIC_API_KEY="YOUR_API_KEY"
```

Or set it programmatically:

```python
import os
import getpass

if "ANTHROPIC_API_KEY" not in os.environ:
    os.environ["ANTHROPIC_API_KEY"] = getpass.getpass("Enter your Anthropic API key: ")
```

## Logging LLM calls

In order to log the LLM calls to Opik, you will need to create the wrap the anthropic client with `track_anthropic`. When making calls with that wrapped client, all calls will be logged to Opik:

```python
import anthropic
from opik.integrations.anthropic import track_anthropic

anthropic_client = anthropic.Anthropic()
anthropic_client = track_anthropic(anthropic_client, project_name="anthropic-integration-demo")

PROMPT = "Why is it important to use a LLM Monitoring like CometML Opik tool that allows you to log traces and spans when working with Anthropic LLM Models?"

response = anthropic_client.messages.create(
    model="claude-3-5-sonnet-20241022",
    max_tokens=1024,
    messages=[
        {"role": "user", "content": PROMPT}
    ]
)
print("Response", response.content[0].text)
```

<Frame>
  <img src="/img/cookbook/anthropic_trace_cookbook.png" />
</Frame>

## Advanced Usage

### Using with the `@track` decorator

If you have multiple steps in your LLM pipeline, you can use the `@track` decorator to log the traces for each step. If Anthropic is called within one of these steps, the LLM call will be associated with that corresponding step:

```python
import anthropic
from opik import track
from opik.integrations.anthropic import track_anthropic

os.environ["OPIK_PROJECT_NAME"] = "anthropic-integration-demo"

anthropic_client = anthropic.Anthropic()
anthropic_client = track_anthropic(anthropic_client)

@track
def generate_story(prompt):
    res = anthropic_client.messages.create(
        model="claude-3-5-sonnet-20241022",
        max_tokens=1024,
        messages=[{"role": "user", "content": prompt}],
    )
    return res.content[0].text

@track
def generate_topic():
    prompt = "Generate a topic for a story about Opik."
    res = anthropic_client.messages.create(
        model="claude-3-5-sonnet-20241022",
        max_tokens=1024,
        messages=[{"role": "user", "content": prompt}],
    )
    return res.content[0].text

@track
def generate_opik_story():
    topic = generate_topic()
    story = generate_story(topic)
    return story

# Execute the multi-step pipeline
generate_opik_story()
```

The trace can now be viewed in the UI with hierarchical spans showing the relationship between different steps:

<Frame>
  <img src="/img/cookbook/anthropic_trace_decorator_cookbook.png" />
</Frame>

## Cost Tracking

The `track_anthropic` wrapper automatically tracks token usage and cost for all supported Anthropic models.

Cost information is automatically captured and displayed in the Opik UI, including:

- Token usage details
- Cost per request based on Anthropic pricing
- Total trace cost

<Tip>
  View the complete list of supported models and providers on the [Supported Models](/tracing/supported_models) page.
</Tip>
