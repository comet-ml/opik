---
description: Workflow for generating E2E tests using Playwright agents
globs: tests_end_to_end/**
alwaysApply: false
---

# Playwright Agent E2E Test Workflow

## Overview

This workflow enables developers to automatically generate end-to-end Playwright tests for new features using Playwright's agent capabilities. The workflow uses three specialized agents that work together:

- **ðŸŽ­ Planner**: Explores the UI and generates markdown test plans
- **ðŸŽ­ Generator**: Transforms test plans into executable Playwright tests
- **ðŸŽ­ Healer**: Automatically fixes failing tests

## When to Use This Workflow

Use this workflow when:

- Developer completes a full-stack feature (frontend + backend)
- Developer explicitly requests: "now add an automated test for this path" or similar
- Developer wants to generate a happy path E2E test for new functionality
- Developer needs comprehensive test coverage for a new user flow

**Example Triggers:**

\`\`\`
"Generate an E2E test for the new project metrics dashboard I just built"
"Create automated test for the dataset upload flow"
"Add happy path test for experiment creation"
"Now write an E2E test for the feature I just implemented"
\`\`\`

## Prerequisites

### 1. Opik Application Running Locally

Before generating tests, ensure the Opik application is running:

\`\`\`bash
# Start the application with dev-runner.sh
./scripts/dev-runner.sh --start

# Verify it's accessible
curl http://localhost:5173
\`\`\`

The frontend should be accessible at \`http://localhost:5173\` (default/BE-only mode) or \`http://localhost:5174\` (standard dev-runner mode).

### 2. Playwright Test Environment Setup

Ensure the E2E test environment is configured:

\`\`\`bash
cd tests_end_to_end/typescript-tests

# Install dependencies if needed
npm install

# Install Playwright browsers if needed
npx playwright install chromium
\`\`\`

### 3. Agent Definitions Available

Agent definitions are located at:
- \`tests_end_to_end/.cursor/agents/playwright-test-planner.md\`
- \`tests_end_to_end/.cursor/agents/playwright-test-generator.md\`
- \`tests_end_to_end/.cursor/agents/playwright-test-healer.md\`

## Agent Workflow

### Phase 1: Planning (ðŸŽ­ Planner Agent)

**Goal**: Explore the UI and generate a comprehensive test plan

**Input**:
- Running Opik application at \`http://localhost:5173\`
- Seed test: \`tests_end_to_end/typescript-tests/tests/seed-for-planner.spec.ts\`
- Developer description of the feature to test

**Output**:
- Markdown test plan saved to: \`tests_end_to_end/typescript-tests/specs/{feature-name}.md\`

### Phase 2: Generation (ðŸŽ­ Generator Agent)

**Goal**: Transform the markdown test plan into executable Playwright tests

**Input**:
- Markdown test plan from \`specs/{feature-name}.md\`
- Existing fixtures in \`typescript-tests/fixtures/\`
- Page objects in \`typescript-tests/page-objects/\`

**Output**:
- Executable test file: \`tests_end_to_end/typescript-tests/tests/{feature-area}/{test-name}.spec.ts\`

### Phase 3: Healing (ðŸŽ­ Healer Agent)

**Goal**: Automatically fix any test failures

**Input**:
- Generated test from Phase 2
- Test failure information

**Output**:
- Passing test or \`test.fixme()\` if the feature itself is broken

## File Organization

### Directory Structure

\`\`\`
tests_end_to_end/
â”œâ”€â”€ .cursor/
â”‚   â”œâ”€â”€ agents/                    # Agent definitions
â”‚   â”‚   â”œâ”€â”€ playwright-test-planner.md
â”‚   â”‚   â”œâ”€â”€ playwright-test-generator.md
â”‚   â”‚   â””â”€â”€ playwright-test-healer.md
â”‚   â””â”€â”€ rules/
â”‚       â””â”€â”€ playwright-agent-workflow.mdc
â”œâ”€â”€ test-helper-service/           # Flask helper service for SDK operations
â”œâ”€â”€ installer_utils/               # Shell scripts for installation checks
â””â”€â”€ typescript-tests/
    â”œâ”€â”€ specs/                     # Markdown test plans (generated by planner)
    â”œâ”€â”€ tests/                     # Executable tests (generated by generator)
    â”œâ”€â”€ fixtures/                  # Test fixtures
    â”œâ”€â”€ page-objects/              # Page objects
    â””â”€â”€ helpers/                   # Helper utilities
\`\`\`

## Summary

The Playwright Agent E2E Test Workflow automates test generation through three phases:

1. **Plan** (ðŸŽ­ Planner): Explore UI â†’ Generate test plan â†’ Save to \`specs/\`
2. **Generate** (ðŸŽ­ Generator): Read plan â†’ Create test code â†’ Save to \`tests/\`
3. **Heal** (ðŸŽ­ Healer): Run test â†’ Fix failures â†’ Iterate until passing

This workflow integrates seamlessly with the existing development process, enabling developers to quickly generate high-quality E2E tests for new features with minimal manual effort.
